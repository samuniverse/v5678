import{r as e,j as s,S as a,e as t,F as r,f as i,h as d,i as l,k as n,L as o,l as c,m,n as u,o as x,p as f,q as p,I as h,t as g,v as j,w as b,x as N,y as v,z as y,B as w,E as k,G as C,H as I,J as S,K as R,M as F,N as D,O as T,U as L,W as $,Y as M,Z as E,_ as U,$ as z,a0 as P,a1 as B,a2 as q,a3 as A,a4 as O,a5 as V,X as _,a6 as H,a7 as Q,a8 as G,a9 as J,aa as K,ab as W,ac as Y,ad as X}from"./react-vendor-CTP5EMOe.js";import{t as Z,z as ee}from"./form-C8bn6GME.js";import{c as se,u as ae,a as te}from"./index-DdlKG3sG.js";import{y as re}from"./vendor-BrKB-IMX.js";import{C as ie,a as de}from"./card-CR9r2zO6.js";import"./ui-vendor-CttiZxwU.js";import"./router-ln9p0bHM.js";const le=re("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 hover-elevate active-elevate-2",{variants:{variant:{default:"bg-primary text-primary-foreground border border-primary-border",destructive:"bg-destructive text-destructive-foreground border border-destructive-border",outline:" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none ",secondary:"border bg-secondary text-secondary-foreground border border-secondary-border ",ghost:"border border-transparent"},size:{default:"min-h-9 px-4 py-2",sm:"min-h-8 rounded-md px-3 text-xs",lg:"min-h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),ne=e.forwardRef(({className:e,variant:t,size:r,asChild:i=!1,...d},l)=>{const n=i?a:"button";return s.jsx(n,{className:se(le({variant:t,size:r,className:e})),ref:l,...d})});ne.displayName="Button";const oe=re("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ce=e.forwardRef(({className:e,...a},r)=>s.jsx(t,{ref:r,className:se(oe(),e),...a}));ce.displayName=t.displayName;const me=r,ue=e.createContext({}),xe=({...e})=>s.jsx(ue.Provider,{value:{name:e.name},children:s.jsx(i,{...e})}),fe=()=>{const s=e.useContext(ue),a=e.useContext(pe),{getFieldState:t,formState:r}=d(),i=t(s.name,r);if(!s)throw new Error("useFormField should be used within <FormField>");const{id:l}=a;return{id:l,name:s.name,formItemId:`${l}-form-item`,formDescriptionId:`${l}-form-item-description`,formMessageId:`${l}-form-item-message`,...i}},pe=e.createContext({}),he=e.forwardRef(({className:a,...t},r)=>{const i=e.useId();return s.jsx(pe.Provider,{value:{id:i},children:s.jsx("div",{ref:r,className:se("space-y-2",a),...t})})});he.displayName="FormItem";const ge=e.forwardRef(({className:e,...a},t)=>{const{error:r,formItemId:i}=fe();return s.jsx(ce,{ref:t,className:se(r&&"text-destructive",e),htmlFor:i,...a})});ge.displayName="FormLabel";const je=e.forwardRef(({...e},t)=>{const{error:r,formItemId:i,formDescriptionId:d,formMessageId:l}=fe();return s.jsx(a,{ref:t,id:i,"aria-describedby":r?`${d} ${l}`:`${d}`,"aria-invalid":!!r,...e})});je.displayName="FormControl";const be=e.forwardRef(({className:e,...a},t)=>{const{formDescriptionId:r}=fe();return s.jsx("p",{ref:t,id:r,className:se("text-sm text-muted-foreground",e),...a})});be.displayName="FormDescription";const Ne=e.forwardRef(({className:e,children:a,...t},r)=>{const{error:i,formMessageId:d}=fe(),l=i?String((null==i?void 0:i.message)??""):a;return l?s.jsx("p",{ref:r,id:d,className:se("text-sm font-medium text-destructive",e),...t,children:l}):null});Ne.displayName="FormMessage";const ve=e.forwardRef(({className:e,...a},t)=>s.jsx("textarea",{className:se("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:t,...a}));ve.displayName="Textarea";const ye=ee.object({urls:ee.string().min(1,"Please enter at least one URL").refine(e=>e.split("\n").map(e=>e.trim()).filter(Boolean).every(e=>{try{return new URL(e),e.includes("smartframe.com")}catch{return!1}}),"All URLs must be valid smartframe.com URLs")});function we({onSubmit:e,isLoading:a,config:t}){const{toast:r}=ae(),i=l({resolver:Z(ye),defaultValues:{urls:""}}),d=n({mutationFn:async e=>{const s=e.urls.split("\n").map(e=>e.trim()).filter(Boolean);return await te("POST","/api/scrape/bulk",{urls:s,...t})},onSuccess:s=>{var a,t;const i=(null==(a=s.jobs)?void 0:a.length)||1,d=s.duplicatesRemoved||0;r({title:"Scrape Started",description:d>0?`Started ${i} scraping job${i>1?"s":""}. Removed ${d} duplicate URL${d>1?"s":""}.`:`Started ${i} scraping job${i>1?"s":""}. This may take a few minutes.`}),e((null==(t=s.jobs)?void 0:t.map(e=>e.jobId))||[s.jobId])},onError:e=>{r({title:"Error",description:e.message||"Failed to start scraping",variant:"destructive"})}});return s.jsx(me,{...i,children:s.jsxs("form",{onSubmit:i.handleSubmit(e=>{d.mutate(e)}),className:"space-y-4",children:[s.jsx(xe,{control:i.control,name:"urls",render:({field:e})=>s.jsxs(he,{children:[s.jsx(ge,{className:"text-sm font-semibold",children:"SmartFrame URLs"}),s.jsx(je,{children:s.jsx(ve,{...e,placeholder:"https://smartframe.com/search?searchQuery=...\nhttps://smartframe.com/search?searchQuery=...",className:"min-h-[120px] font-mono text-sm","data-testid":"input-urls",disabled:a||d.isPending})}),s.jsx(be,{className:"text-xs",children:"Enter one or more SmartFrame search URLs (one per line)"}),s.jsx(Ne,{})]})}),s.jsx(ne,{type:"submit",className:"w-full h-12 gap-2",disabled:a||d.isPending,"data-testid":"button-start-scrape",children:d.isPending||a?s.jsxs(s.Fragment,{children:[s.jsx(o,{className:"w-4 h-4 animate-spin"}),"Scraping..."]}):s.jsxs(s.Fragment,{children:[s.jsx(c,{className:"w-4 h-4"}),"Start Scraping"]})})]})})}const ke=e.forwardRef(({className:e,type:a,...t},r)=>s.jsx("input",{type:a,className:se("flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:r,...t}));ke.displayName="Input";const Ce=e.forwardRef(({className:e,...a},t)=>s.jsx(m,{className:se("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...a,ref:t,children:s.jsx(u,{className:se("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Ce.displayName=m.displayName;const Ie=x,Se=f,Re=e.forwardRef(({className:e,children:a,...t},r)=>s.jsxs(p,{ref:r,className:se("flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...t,children:[a,s.jsx(h,{asChild:!0,children:s.jsx(g,{className:"h-4 w-4 opacity-50"})})]}));Re.displayName=p.displayName;const Fe=e.forwardRef(({className:e,...a},t)=>s.jsx(C,{ref:t,className:se("flex cursor-default items-center justify-center py-1",e),...a,children:s.jsx(I,{className:"h-4 w-4"})}));Fe.displayName=C.displayName;const De=e.forwardRef(({className:e,...a},t)=>s.jsx(S,{ref:t,className:se("flex cursor-default items-center justify-center py-1",e),...a,children:s.jsx(g,{className:"h-4 w-4"})}));De.displayName=S.displayName;const Te=e.forwardRef(({className:e,children:a,position:t="popper",...r},i)=>s.jsx(j,{children:s.jsxs(b,{ref:i,className:se("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===t&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:t,...r,children:[s.jsx(Fe,{}),s.jsx(N,{className:se("p-1","popper"===t&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),s.jsx(De,{})]})}));Te.displayName=b.displayName;e.forwardRef(({className:e,...a},t)=>s.jsx(R,{ref:t,className:se("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...a})).displayName=R.displayName;const Le=e.forwardRef(({className:e,children:a,...t},r)=>s.jsxs(v,{ref:r,className:se("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...t,children:[s.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:s.jsx(y,{children:s.jsx(w,{className:"h-4 w-4"})})}),s.jsx(k,{children:a})]}));Le.displayName=v.displayName;function $e({config:e,onChange:a}){const t=s=>{a({...e,...s})};return s.jsxs("div",{className:"space-y-4 pt-4 border-t border-border",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(ce,{htmlFor:"maxImages",className:"text-sm font-medium",children:"Maximum Images"}),s.jsx(ke,{id:"maxImages",type:"number",min:"0",max:"500",value:e.maxImages,onChange:e=>t({maxImages:parseInt(e.target.value)||0}),className:"h-10","data-testid":"input-max-images"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Limit the number of images to scrape (0 for unlimited, max 500)"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(ce,{htmlFor:"sortBy",className:"text-sm font-medium",children:"Sort By"}),s.jsxs(Ie,{value:e.sortBy,onValueChange:e=>t({sortBy:e}),children:[s.jsx(Re,{className:"h-10","data-testid":"select-sort-by",children:s.jsx(Se,{})}),s.jsxs(Te,{children:[s.jsx(Le,{value:"relevance",children:"Relevance"}),s.jsx(Le,{value:"newest",children:"Newest"}),s.jsx(Le,{value:"oldest",children:"Oldest"})]})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(ce,{htmlFor:"extractDetails",className:"text-sm font-medium",children:"Extract Details"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Fetch photographer, location, and date information"})]}),s.jsx(Ce,{id:"extractDetails",checked:e.extractDetails,onCheckedChange:e=>t({extractDetails:e}),"data-testid":"switch-extract-details"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(ce,{htmlFor:"autoScroll",className:"text-sm font-medium",children:"Auto Scroll"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatically handle infinite scrolling"})]}),s.jsx(Ce,{id:"autoScroll",checked:e.autoScroll,onCheckedChange:e=>t({autoScroll:e}),"data-testid":"switch-auto-scroll"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(ce,{htmlFor:"scrollDelay",className:"text-sm font-medium",children:"Scroll Delay (ms)"}),s.jsx(ke,{id:"scrollDelay",type:"number",min:"500",max:"5000",step:"100",value:e.scrollDelay,onChange:e=>t({scrollDelay:parseInt(e.target.value)||500}),className:"h-10","data-testid":"input-scroll-delay"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Delay between scroll actions (500-5000ms)"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(ce,{htmlFor:"concurrency",className:"text-sm font-medium",children:"Parallel Tabs (Speed)"}),s.jsx(ke,{id:"concurrency",type:"number",min:"1",max:"20",value:e.concurrency,onChange:e=>t({concurrency:parseInt(e.target.value)||5}),className:"h-10","data-testid":"input-concurrency"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Number of concurrent browser tabs for parallel processing (1-20, default: 5)"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(ce,{htmlFor:"orderedSequential",className:"text-sm font-medium",children:"Ordered Sequential Mode"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Process tabs one at a time with active focus for better rendering"})]}),s.jsx(Ce,{id:"orderedSequential",checked:e.orderedSequential||!1,onCheckedChange:e=>t({orderedSequential:e}),"data-testid":"switch-ordered-sequential"})]}),e.orderedSequential&&s.jsxs("div",{className:"space-y-4 pl-4 border-l-2 border-primary/20",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(ce,{htmlFor:"interTabDelayMin",className:"text-sm font-medium",children:"Min Tab Delay (ms)"}),s.jsx(ke,{id:"interTabDelayMin",type:"number",min:"1000",max:"10000",step:"500",value:e.interTabDelayMin||3e3,onChange:e=>t({interTabDelayMin:parseInt(e.target.value)||3e3}),className:"h-10","data-testid":"input-inter-tab-delay-min"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Minimum delay between tabs (1000-10000ms)"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(ce,{htmlFor:"interTabDelayMax",className:"text-sm font-medium",children:"Max Tab Delay (ms)"}),s.jsx(ke,{id:"interTabDelayMax",type:"number",min:"1000",max:"10000",step:"500",value:e.interTabDelayMax||5e3,onChange:e=>t({interTabDelayMax:parseInt(e.target.value)||5e3}),className:"h-10","data-testid":"input-inter-tab-delay-max"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Maximum delay between tabs (1000-10000ms)"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(ce,{htmlFor:"canvasExtraction",className:"text-sm font-medium",children:"Canvas Image Extraction"}),s.jsxs(Ie,{value:e.canvasExtraction,onValueChange:e=>t({canvasExtraction:e}),children:[s.jsx(Re,{className:"h-10","data-testid":"select-canvas-extraction",children:s.jsx(Se,{})}),s.jsxs(Te,{children:[s.jsx(Le,{value:"none",children:"No Canvas Images"}),s.jsx(Le,{value:"thumbnail",children:"Thumbnail (600x600)"}),s.jsx(Le,{value:"full",children:"High Resolution (9999x9999)"})]})]}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Extract canvas images from SmartFrame embeds (requires visible browser)"})]})]})}e.forwardRef(({className:e,...a},t)=>s.jsx(F,{ref:t,className:se("-mx-1 my-1 h-px bg-muted",e),...a})).displayName=F.displayName;const Me=e.forwardRef(({className:e,value:a,...t},r)=>s.jsx(D,{ref:r,className:se("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...t,children:s.jsx(T,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));Me.displayName=D.displayName;const Ee=re("whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 hover-elevate ",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow-xs",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground shadow-xs",outline:" border [border-color:var(--badge-outline)] shadow-xs"}},defaultVariants:{variant:"default"}});function Ue({className:e,variant:a,...t}){return s.jsx("div",{className:se(Ee({variant:a}),e),...t})}function ze({status:e}){const a={pending:{label:"Pending",className:"bg-muted text-muted-foreground"},scraping:{label:"Scraping",className:"bg-primary text-primary-foreground"},completed:{label:"Complete",className:"bg-success text-success-foreground"},error:{label:"Error",className:"bg-destructive text-destructive-foreground"}}[e];return s.jsx(Ue,{className:a.className,"data-testid":`badge-status-${e}`,children:a.label})}function Pe({job:e}){const a="scraping"===e.status?o:"completed"===e.status?L:$,t="scraping"===e.status?"text-primary":"completed"===e.status?"text-success":"text-destructive";return s.jsx(ie,{className:"p-6","data-testid":"card-progress",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-sm font-semibold text-card-foreground",children:"Scraping Progress"}),s.jsx(ze,{status:e.status})]}),s.jsx(Me,{value:e.progress,className:"h-2"}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(a,{className:`w-4 h-4 ${t} ${"scraping"===e.status?"animate-spin":""}`}),s.jsxs("span",{className:"text-muted-foreground",children:[e.scrapedImages," of ",e.totalImages||"?"," images scraped"]}),s.jsxs("span",{className:"text-muted-foreground ml-auto",children:[Math.round(e.progress),"%"]})]}),e.error&&s.jsxs("div",{className:"text-xs text-destructive bg-destructive/10 p-3 rounded-md border border-destructive/20",children:[s.jsx("p",{className:"font-medium",children:"Error:"}),s.jsx("p",{className:"mt-1",children:e.error})]})]})})}function Be({image:e}){const{toast:a}=ae();return s.jsxs(ie,{className:"overflow-hidden hover-elevate","data-testid":`card-image-${e.imageId}`,children:[s.jsx("div",{className:"aspect-square bg-muted flex items-center justify-center relative overflow-hidden",children:e.thumbnailUrl?s.jsx("img",{src:e.thumbnailUrl,alt:e.titleField||e.smartframeId,className:"w-full h-full object-cover"}):s.jsx(M,{className:"w-16 h-16 text-muted-foreground"})}),s.jsxs(de,{className:"p-4 space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Image ID"}),s.jsx("p",{className:"text-sm font-mono text-foreground truncate",title:e.smartframeId,children:e.smartframeId})]}),e.titleField&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Title"}),s.jsx("p",{className:"text-sm text-foreground truncate",title:e.titleField,children:e.titleField})]}),e.authors&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Authors"}),s.jsx("p",{className:"text-sm text-foreground truncate",title:e.authors,children:e.authors})]}),e.dateTaken&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Date Taken"}),s.jsx("p",{className:"text-sm text-foreground",children:e.dateTaken})]}),e.subjectField&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Subject"}),s.jsx("p",{className:"text-sm text-foreground truncate",title:e.subjectField,children:e.subjectField})]}),s.jsxs("div",{className:"flex gap-2 pt-2",children:[s.jsxs(ne,{variant:"outline",size:"sm",className:"flex-1 gap-2",onClick:async()=>{try{await navigator.clipboard.writeText(e.copyLink),a({title:"Link Copied",description:"The image URL has been copied to your clipboard."})}catch(s){a({title:"Copy Failed",description:"Could not copy the link to clipboard.",variant:"destructive"})}},"data-testid":`button-copy-${e.imageId}`,children:[s.jsx(E,{className:"w-3 h-3"}),"Copy Link"]}),s.jsx(ne,{variant:"outline",size:"sm",asChild:!0,"data-testid":`button-view-${e.imageId}`,children:s.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:s.jsx(U,{className:"w-3 h-3"})})})]})]})]})}function qe({images:e}){return 0===e.length?s.jsx("div",{className:"bg-card rounded-lg border border-card-border p-12 text-center",children:s.jsx("p",{className:"text-muted-foreground",children:"No images match your search criteria."})}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>s.jsx(Be,{image:e},e.imageId))})}const Ae=e.forwardRef(({className:e,...a},t)=>s.jsx("div",{className:"relative w-full overflow-auto",children:s.jsx("table",{ref:t,className:se("w-full caption-bottom text-sm",e),...a})}));Ae.displayName="Table";const Oe=e.forwardRef(({className:e,...a},t)=>s.jsx("thead",{ref:t,className:se("[&_tr]:border-b",e),...a}));Oe.displayName="TableHeader";const Ve=e.forwardRef(({className:e,...a},t)=>s.jsx("tbody",{ref:t,className:se("[&_tr:last-child]:border-0",e),...a}));Ve.displayName="TableBody";e.forwardRef(({className:e,...a},t)=>s.jsx("tfoot",{ref:t,className:se("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...a})).displayName="TableFooter";const _e=e.forwardRef(({className:e,...a},t)=>s.jsx("tr",{ref:t,className:se("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...a}));_e.displayName="TableRow";const He=e.forwardRef(({className:e,...a},t)=>s.jsx("th",{ref:t,className:se("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...a}));He.displayName="TableHead";const Qe=e.forwardRef(({className:e,...a},t)=>s.jsx("td",{ref:t,className:se("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...a}));Qe.displayName="TableCell";function Ge({images:a}){const{toast:t}=ae(),r=e.useCallback(async e=>{try{await navigator.clipboard.writeText(e),t({title:"Link Copied",description:"The image URL has been copied to your clipboard."})}catch(s){t({title:"Copy Failed",description:"Could not copy the link to clipboard.",variant:"destructive"})}},[t]);return 0===a.length?s.jsx("div",{className:"bg-card rounded-lg border border-card-border p-12 text-center",children:s.jsx("p",{className:"text-muted-foreground",children:"No images match your search criteria."})}):s.jsx("div",{className:"bg-card rounded-lg border border-card-border overflow-hidden",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(Ae,{children:[s.jsx(Oe,{children:s.jsxs(_e,{children:[s.jsx(He,{className:"w-20",children:"Preview"}),s.jsx(He,{children:"Image ID"}),s.jsx(He,{children:"Title"}),s.jsx(He,{children:"Authors"}),s.jsx(He,{children:"Subject"}),s.jsx(He,{children:"Date Taken"}),s.jsx(He,{className:"text-right",children:"Actions"})]})}),s.jsx(Ve,{children:a.map(e=>s.jsxs(_e,{"data-testid":`row-image-${e.imageId}`,children:[s.jsx(Qe,{children:s.jsx("div",{className:"w-16 h-16 bg-muted rounded-md flex items-center justify-center overflow-hidden",children:e.thumbnailUrl?s.jsx("img",{src:e.thumbnailUrl,alt:e.smartframeId,className:"w-full h-full object-cover"}):s.jsx(M,{className:"w-6 h-6 text-muted-foreground"})})}),s.jsx(Qe,{className:"font-mono text-sm",children:e.smartframeId}),s.jsx(Qe,{className:"text-sm",children:e.titleField||"—"}),s.jsx(Qe,{className:"text-sm",children:e.authors||"—"}),s.jsx(Qe,{className:"text-sm",children:e.subjectField||"—"}),s.jsx(Qe,{className:"text-sm",children:e.dateTaken||"—"}),s.jsx(Qe,{className:"text-right",children:s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx(ne,{variant:"ghost",size:"icon",onClick:()=>r(e.copyLink),"data-testid":`button-copy-table-${e.imageId}`,children:s.jsx(E,{className:"w-4 h-4"})}),s.jsx(ne,{variant:"ghost",size:"icon",asChild:!0,children:s.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer","data-testid":`button-view-table-${e.imageId}`,children:s.jsx(U,{className:"w-4 h-4"})})})]})})]},e.imageId))})]})})})}function Je({job:a,viewMode:t,onViewModeChange:r}){const[i,d]=e.useState(""),l=e.useMemo(()=>{var e;return(null==(e=a.images)?void 0:e.filter(e=>{var s,a,t,r;if(!i)return!0;const d=i.toLowerCase();return e.imageId.toLowerCase().includes(d)||e.smartframeId.toLowerCase().includes(d)||(null==(s=e.authors)?void 0:s.toLowerCase().includes(d))||(null==(a=e.titleField)?void 0:a.toLowerCase().includes(d))||(null==(t=e.subjectField)?void 0:t.toLowerCase().includes(d))||(null==(r=e.tags)?void 0:r.toLowerCase().includes(d))}))||[]},[a.images,i]);return"error"===a.status?s.jsx("div",{className:"bg-card rounded-lg border border-card-border p-12 text-center",children:s.jsxs("div",{className:"max-w-md mx-auto space-y-4",children:[s.jsx("div",{className:"w-20 h-20 bg-destructive/10 rounded-full flex items-center justify-center mx-auto",children:s.jsx("svg",{className:"w-10 h-10 text-destructive",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),s.jsx("h3",{className:"text-xl font-semibold text-foreground",children:"Scraping Failed"}),s.jsx("p",{className:"text-muted-foreground",children:a.error||"An unknown error occurred"})]})}):a.images&&0!==a.images.length?s.jsxs("div",{className:"space-y-6",children:["scraping"===a.status&&s.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4 flex items-center gap-3 animate-pulse",children:[s.jsx(o,{className:"w-5 h-5 text-primary animate-spin flex-shrink-0"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("p",{className:"text-sm font-medium text-primary",children:["Scraping in progress - ",a.scrapedImages," of ",a.totalImages||"?"," images extracted"]}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Results will update automatically as more images are discovered"})]})]}),s.jsx("div",{className:"bg-card rounded-lg border border-card-border p-4",children:s.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between",children:[s.jsxs("div",{className:"relative flex-1 max-w-md",children:[s.jsx(z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),s.jsx(ke,{placeholder:"Search by ID, title, author, subject, or tags...",value:i,onChange:e=>d(e.target.value),className:"pl-10 h-10","data-testid":"input-search"})]}),s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs("span",{className:"text-sm text-muted-foreground mr-2",children:[l.length," ",1===l.length?"result":"results","scraping"===a.status&&" (updating...)"]}),s.jsx(ne,{variant:"grid"===t?"default":"outline",size:"icon",onClick:()=>r("grid"),"data-testid":"button-view-grid",title:"Grid view",children:s.jsx(P,{className:"w-4 h-4"})}),s.jsx(ne,{variant:"table"===t?"default":"outline",size:"icon",onClick:()=>r("table"),"data-testid":"button-view-table",title:"Table view",children:s.jsx(B,{className:"w-4 h-4"})})]})]})}),"grid"===t?s.jsx(qe,{images:l}):s.jsx(Ge,{images:l})]}):s.jsx("div",{className:"bg-card rounded-lg border border-card-border p-12 text-center shadow-sm",children:s.jsxs("div",{className:"max-w-md mx-auto space-y-4",children:[s.jsx("div",{className:"w-20 h-20 bg-primary/10 rounded-full flex items-center justify-center mx-auto animate-pulse",children:"scraping"===a.status?s.jsx(o,{className:"w-10 h-10 text-primary animate-spin"}):s.jsx(z,{className:"w-10 h-10 text-muted-foreground"})}),s.jsx("h3",{className:"text-xl font-semibold text-foreground",children:"scraping"===a.status?"Scraping in Progress...":"No Results"}),s.jsx("p",{className:"text-muted-foreground",children:"scraping"===a.status?"Please wait while we extract image data from the page. This may take a few minutes.":"No images were found at the provided URL."}),"scraping"===a.status&&s.jsxs("div",{className:"pt-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[s.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"0ms"}}),s.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"150ms"}}),s.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),s.jsx("p",{className:"text-sm text-primary font-medium animate-pulse",children:"Loading page and discovering images..."})]})]})})}e.forwardRef(({className:e,...a},t)=>s.jsx("caption",{ref:t,className:se("mt-4 text-sm text-muted-foreground",e),...a})).displayName="TableCaption";const Ke=q,We=A,Ye=e.forwardRef(({className:e,...a},t)=>s.jsx(G,{ref:t,className:se("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a}));Ye.displayName=G.displayName;const Xe=e.forwardRef(({className:e,children:a,...t},r)=>s.jsxs(We,{children:[s.jsx(Ye,{}),s.jsxs(O,{ref:r,className:se("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t,children:[a,s.jsxs(V,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[s.jsx(_,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Xe.displayName=O.displayName;const Ze=({className:e,...a})=>s.jsx("div",{className:se("flex flex-col space-y-1.5 text-center sm:text-left",e),...a});Ze.displayName="DialogHeader";const es=({className:e,...a})=>s.jsx("div",{className:se("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a});es.displayName="DialogFooter";const ss=e.forwardRef(({className:e,...a},t)=>s.jsx(H,{ref:t,className:se("text-lg font-semibold leading-none tracking-tight",e),...a}));ss.displayName=H.displayName;const as=e.forwardRef(({className:e,...a},t)=>s.jsx(Q,{ref:t,className:se("text-sm text-muted-foreground",e),...a}));function ts({job:a,onClose:t}){var r,i,d,l,n,o,c,m,u;const[x,f]=e.useState("json"),{toast:p}=ae();return s.jsx(Ke,{open:!0,onOpenChange:t,children:s.jsxs(Xe,{className:"sm:max-w-md","data-testid":"modal-export",children:[s.jsxs(Ze,{children:[s.jsx(ss,{children:"Export Scraped Data"}),s.jsx(as,{children:"Choose your preferred format to download the scraped image data."})]}),s.jsxs("div",{className:"space-y-4 py-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs("button",{onClick:()=>f("json"),className:se("w-full flex items-center space-x-3 p-4 rounded-lg border transition-colors cursor-pointer","json"===x?"border-primary bg-primary/5":"border-border hover:border-primary/50"),"data-testid":"radio-format-json",children:[s.jsx("div",{className:se("flex items-center justify-center w-5 h-5 rounded-full border-2","json"===x?"border-primary bg-primary":"border-muted-foreground"),children:"json"===x&&s.jsx(w,{className:"w-3 h-3 text-primary-foreground"})}),s.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[s.jsx(J,{className:"w-5 h-5 text-primary"}),s.jsxs("div",{className:"text-left",children:[s.jsx("p",{className:"font-medium",children:"JSON"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Structured data with all metadata"})]})]})]}),s.jsxs("button",{onClick:()=>f("csv"),className:se("w-full flex items-center space-x-3 p-4 rounded-lg border transition-colors cursor-pointer","csv"===x?"border-primary bg-primary/5":"border-border hover:border-primary/50"),"data-testid":"radio-format-csv",children:[s.jsx("div",{className:se("flex items-center justify-center w-5 h-5 rounded-full border-2","csv"===x?"border-primary bg-primary":"border-muted-foreground"),children:"csv"===x&&s.jsx(w,{className:"w-3 h-3 text-primary-foreground"})}),s.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[s.jsx(K,{className:"w-5 h-5 text-success"}),s.jsxs("div",{className:"text-left",children:[s.jsx("p",{className:"font-medium",children:"CSV"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Spreadsheet-compatible format"})]})]})]})]}),s.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[s.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide mb-2",children:"Preview"}),s.jsx("div",{className:"bg-background rounded-md p-3 font-mono text-xs overflow-x-auto",children:"json"===x?s.jsx("pre",{children:`{\n  "jobId": "${a.id}",\n  "totalImages": ${(null==(r=a.images)?void 0:r.length)||0},\n  "images": [...]\n}`}):s.jsx("pre",{children:`Image ID,Title,Authors,Subject,Tags\n"${(null==(d=null==(i=a.images)?void 0:i[0])?void 0:d.smartframeId)||"..."}","${(null==(n=null==(l=a.images)?void 0:l[0])?void 0:n.titleField)||"..."}","${(null==(c=null==(o=a.images)?void 0:o[0])?void 0:c.authors)||"..."}","${(null==(u=null==(m=a.images)?void 0:m[0])?void 0:u.subjectField)||"..."}","..."`})})]})]}),s.jsxs(es,{className:"flex gap-2",children:[s.jsx(ne,{variant:"outline",onClick:t,"data-testid":"button-cancel-export",children:"Cancel"}),s.jsxs(ne,{onClick:async()=>{try{const e=await fetch(`/api/export/${a.id}?format=${x}`);if(!e.ok)throw new Error("Export failed");const s=await e.blob(),r=window.URL.createObjectURL(s),i=document.createElement("a");i.href=r,i.download=`smartframe-export-${a.id}.${x}`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(r),document.body.removeChild(i),p({title:"Export Successful",description:`Your data has been downloaded as ${x.toUpperCase()}.`}),t()}catch(e){p({title:"Export Failed",description:"Could not export the data. Please try again.",variant:"destructive"})}},className:"gap-2","data-testid":"button-download",children:[s.jsx(W,{className:"w-4 h-4"}),"Download ",x.toUpperCase()]})]})]})})}function rs(){const[a,t]=e.useState(null),[r,i]=e.useState(!1),[d,l]=e.useState(!1),[n,o]=e.useState("grid"),[c,m]=e.useState({maxImages:0,extractDetails:!0,sortBy:"relevance",autoScroll:!0,scrollDelay:1e3,concurrency:5,canvasExtraction:"none"}),{data:u}=Y({queryKey:["/api/scrape/job",a],enabled:!!a,refetchInterval:e=>{const s=e.state.data;return"scraping"===(null==s?void 0:s.status)&&1e3}}),x=e.useCallback(e=>{e.length>0&&t(e[0])},[]),f=e.useMemo(()=>(null==u?void 0:u.images)&&u.images.length>0,[null==u?void 0:u.images]);return s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx("header",{className:"sticky top-0 z-50 bg-card border-b border-card-border shadow-sm",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-6 h-20 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-primary rounded-md flex items-center justify-center",children:s.jsx(X,{className:"w-6 h-6 text-primary-foreground"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"SmartFrame Scraper"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Professional Image Metadata Extraction"})]})]}),f&&s.jsxs(ne,{onClick:()=>l(!0),variant:"default",className:"gap-2","data-testid":"button-export",children:[s.jsx(W,{className:"w-4 h-4"}),"Export Data"]})]})}),s.jsx("main",{className:"max-w-7xl mx-auto px-6 py-8",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[s.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[s.jsxs("div",{className:"bg-card rounded-lg border border-card-border p-6 shadow-sm",children:[s.jsx("h2",{className:"text-lg font-semibold text-card-foreground mb-4",children:"Scrape Configuration"}),s.jsx(we,{onSubmit:x,isLoading:"scraping"===(null==u?void 0:u.status),config:c}),s.jsxs("button",{onClick:()=>i(!r),className:"mt-4 text-sm text-primary hover:underline","data-testid":"button-toggle-config",children:[r?"Hide":"Show"," Advanced Options"]}),r&&s.jsx("div",{className:"mt-4",children:s.jsx($e,{config:c,onChange:m})})]}),u&&"scraping"===u.status&&s.jsx(Pe,{job:u})]}),s.jsx("div",{className:"lg:col-span-2",children:u?s.jsx(Je,{job:u,viewMode:n,onViewModeChange:o}):s.jsx("div",{className:"bg-card rounded-lg border border-card-border p-12 text-center shadow-sm",children:s.jsxs("div",{className:"max-w-md mx-auto space-y-4",children:[s.jsx("div",{className:"w-20 h-20 bg-muted rounded-full flex items-center justify-center mx-auto",children:s.jsx(X,{className:"w-10 h-10 text-muted-foreground"})}),s.jsx("h3",{className:"text-xl font-semibold text-foreground",children:"Ready to Extract Image Data"}),s.jsx("p",{className:"text-muted-foreground",children:"Enter one or more SmartFrame search URLs in the form to start scraping image metadata. The tool will automatically handle infinite scrolling and extract detailed information."}),s.jsxs("div",{className:"pt-4 text-sm text-muted-foreground space-y-1",children:[s.jsx("p",{className:"font-medium",children:"Example URLs (one per line):"}),s.jsx("code",{className:"block bg-muted px-4 py-2 rounded-md text-xs break-all whitespace-pre-wrap",children:"https://smartframe.com/search?searchQuery=steps&sortBy=relevance"})]})]})})})]})}),d&&u&&s.jsx(ts,{job:u,onClose:()=>l(!1)})]})}as.displayName=Q.displayName;export{rs as default};
